### **Warp 发散的典型情况**
	- **条件分支语句（if-else）**：
		- 如果 warp 中的线程在 `if` 和 `else` 中选择了不同的路径，GPU 会先执行 `if` 路径，然后再执行 `else` 路径，未执行路径的线程会被屏蔽。
		- 示例：
			- ```
			  __global__ void example1() {
			   int tid = threadIdx.x;
			   if (tid % 2 == 0) {
			       // 偶数线程执行这里
			   } else {
			       // 奇数线程执行这里
			   }
			  }
			  ```
			- 在上面的代码中：
			- 一个 warp 包含 32 个线程，线程索引为 `0, 1, 2, ..., 31`。
			- 偶数线程（`0, 2, 4, ...`）将进入 `if` 分支，奇数线程（`1, 3, 5, ...`）将进入 `else` 分支。
			- 结果是：GPU 必须分别执行 `if` 和 `else` 的代码，两次执行才能完成整个 warp 的计算，导致效率下降。
	- **循环中条件分支**：
		- 当 warp 中的线程在循环中执行不同的迭代次数时，会导致发散。
		- 示例：
			- ```
			  __global__ void example2() {
			   int tid = threadIdx.x;
			   for (int i = 0; i < tid; i++) {
			       // 不同线程执行不同次数的循环
			   }
			  }
			  ```
			- 在上面的代码中：
			- 线程索引较大的线程会执行更多次循环，而线程索引较小的线程会提前退出循环。
			- GPU 必须等待所有线程完成循环，导致线程之间的执行不一致，并降低效率。
	- **Switch 语句**：
		- 类似于 `if-else`，`switch` 语句也会导致 warp 发散。
- ### **如何避免或减少 Warp 发散？**
	- **尽量减少分支条件**：
		- 避免 warp 内线程出现复杂的 `if-else` 或 `switch` 语句。
		- 可以通过数学公式替代分支逻辑。例如：
			- ```
			  // 避免分支
			  int result = (tid % 2 == 0) ? a + b : a - b;
			  
			  // 替代为
			  int result = a + b - 2 * (tid % 2) * b;
			  ```
	- **确保线程执行路径一致**：
		- 对于一个 warp 内的线程，尽量保证线程的执行路径一致。
		- 例如，将 `if-else` 分支逻辑放到线程块内，而不是 warp 内。
	- **调整线程块和线程布局**：
		- 根据数据的规律性，调整线程块的结构，尽量让 warp 中的线程执行相似的逻辑。
		- 示例（避免线程索引直接影响分支）：
			- ```
			  // 不好的线程分配方式
			  if (threadIdx.x < 16) {
			   // 一部分线程执行这里
			  } else {
			   // 另一部分线程执行这里
			  }
			  
			  // 更好的方式
			  int group = threadIdx.x / warpSize;  // 根据 warp 分组
			  if (group == 0) {
			   // warp 内线程执行相同逻辑
			  } else {
			   // 另一组 warp 执行这里
			  }
			  ```
	- **统一分支逻辑**：
		- 将分支逻辑搬到 warp 外部，或者通过预处理方式让每个 warp 内线程执行相同的分支。